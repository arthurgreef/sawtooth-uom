FROM libsnark

WORKDIR /root

# install prerequisite
RUN apt-get update && apt-get install -y nano libpcre3-dev python3-dev python3-pip && \
	wget http://prdownloads.sourceforge.net/swig/swig-3.0.12.tar.gz && \
	tar xf swig-3.0.12.tar.gz && cd swig-3.0.12 && \
	./configure --prefix=/usr && make -j 4 && make install && \
	python3 -m pip install --upgrade pip && \
	mkdir -p /hashblock-exchange/zkSNARK

ENV CPATH /usr/local/usr/local/include

WORKDIR /hashblock-exchange/zkSNARK
COPY zkSNARK .
WORKDIR /hashblock-exchange/zkSNARK/hashblock_zksnark

RUN cp -r /root/libsnark/libsnark/zk_proof_systems/ppzkadsnark/r1cs_ppzkadsnark/examples /usr/local/usr/local/include/libsnark/zk_proof_systems/ppzkadsnark/r1cs_ppzkadsnark/
RUN cp -r /root/libsnark/depends/libfqfft/libfqfft /usr/local/usr/local/include/libfqfft/

RUN	swig -c++ -python -o src/hashblock_zksnark.cxx hashblock_zksnark.i
# RUN python3 setup.py build_ext && cp src/hashblock_zksnark.py . && python3 setup.py bdist_wheel

