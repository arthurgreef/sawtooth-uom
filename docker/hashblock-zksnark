FROM libsnark

WORKDIR /root

# install prerequisite
RUN apt-get update && apt-get install -y nano libpcre3-dev python3-dev python3-pip && \
	wget http://prdownloads.sourceforge.net/swig/swig-3.0.12.tar.gz && \
	tar xf swig-3.0.12.tar.gz && cd swig-3.0.12 && \
	./configure --prefix=/usr && make -j 4 && make install && \
	python3 -m pip install --upgrade pip && \
	mkdir -p /hashblock-exchange/zkSNARK

WORKDIR /hashblock-exchange/zkSNARK
COPY zkSNARK .

WORKDIR /root/libsnark
RUN perl -i -0pe 's/demo_r1cs_ppzkadsnark.*\n.*EXCLUDE_FROM_ALL/demo_r1cs_ppzkadsnark/' ~/libsnark/libsnark/CMakeLists.txt && \
    rm -R build && \
	mkdir build && cd build && cmake .. && \
	make && \
	make install 
